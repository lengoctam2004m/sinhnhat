<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Happy Birthday üíñ</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<style>
  /* Reset + font */
  html,body{margin:0;height:100%;font-family:"Segoe UI",system-ui,-apple-system,sans-serif;overflow:hidden}

  /* ===== PASS SCREEN ===== */
  #passScreen{
    position:fixed;inset:0;display:flex;justify-content:center;align-items:center;
    background:linear-gradient(135deg,#ffe6ec,#ffd6f6);z-index:10
  }
  .pass-box{
    display:flex;flex-direction:row;max-width:95vw;width:650px;border-radius:20px;
    overflow:hidden;background:#fff;box-shadow:0 10px 35px rgba(0,0,0,.25)
  }
  .pass-left{flex:1;display:flex;align-items:center;justify-content:center;background:#ffe6ec;padding:20px}
  .pass-left img{
    width:100%;max-width:250px;height:auto;border-radius:20px;border:8px solid #fff;
    object-fit:cover;box-shadow:0 10px 25px rgba(0,0,0,.25)
  }
  .pass-right{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}
  .pass-right h2{margin:0 0 14px;color:#ff4d88;font-size:20px;text-align:center}
  .dots{color:#ff4d88;font-size:26px;letter-spacing:12px;margin-bottom:16px}
  .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;width:100%;max-width:240px}
  .keypad button{
    aspect-ratio:1/1;border:none;border-radius:12px;background:#f2f2f2;font-weight:700;font-size:18px;cursor:pointer;
    transition:.15s;box-shadow:0 2px 0 rgba(0,0,0,.06) inset
  }
  .keypad button:active{transform:scale(.96);background:#ff99cc;color:#fff}
  @media(max-width:768px){
    .pass-box{flex-direction:column;width:92vw}
    .pass-left img{max-width:180px}
    .dots{font-size:22px}
  }

  /* ===== BOOK SCREEN (thi·ªáp) ===== */
  #bookScreen{
    position:fixed;inset:0;display:none;justify-content:center;align-items:center;
    background:linear-gradient(120deg,#ffe6f0,#fff0f6);z-index:20
  }
  .book{position:relative;width:min(92vw,650px);height:420px;perspective:1500px}
  .page{position:absolute;inset:0;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.18)}
  .cover{
    background:#ffb3c6;display:flex;align-items:center;justify-content:center;
    font-weight:700;color:#222;cursor:pointer;transform-origin:left center;transition:transform 1s ease;z-index:2
  }
  .cover.open{transform:rotateY(-100deg);pointer-events:none}
  .inner{
    background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;
    text-align:center;padding:30px;z-index:1
  }
  .inner h2{margin:0 0 14px;color:#ff3366}
  .inner p{margin:0;color:#444;line-height:1.6}
  #closeBtn{
    margin-top:22px;border:none;border-radius:10px;background:#ff3366;color:#fff;font-weight:700;
    padding:10px 18px;cursor:pointer;box-shadow:0 6px 18px rgba(255,51,102,.35);transition:.15s
  }
  #closeBtn:active{transform:scale(.97);background:#ff0a54}

  /* ===== GALAXY ===== */
  #canvasScreen{position:fixed;inset:0;display:none;background:#000;z-index:5}
  #c{width:100%;height:100%;display:block}
</style>
</head>
<body>

<!-- PASS -->
<div id="passScreen">
  <div class="pass-box">
    <div class="pass-left"><img src="anh/anh4.jpg" alt="avatar"></div>
    <div class="pass-right">
      <h2>Xin ch√†o C√¥ng ch√∫a B·∫£o Ng·ªçc üíñ</h2>
      <div id="dots" class="dots">****</div>
      <div class="keypad">
        <button>1</button><button>2</button><button>3</button>
        <button>4</button><button>5</button><button>6</button>
        <button>7</button><button>8</button><button>9</button>
        <button>‚Üê</button><button>0</button><button>‚úì</button>
      </div>
    </div>
  </div>
</div>

<!-- BOOK -->
<div id="bookScreen">
  <div class="book">
    <!-- d√πng üìñ ƒë·ªÉ tr√°nh l·ªói render emoji -->
    <div class="page cover" id="cover"><span>üìñ C√¥ng ch√∫a h√£y m·ªü thi·ªáp ƒëi</span></div>
    <div class="page inner">
      <h2>üéÇ Ch√∫c m·ª´ng sinh nh·∫≠t üéÇ</h2>
      <p>
        Ch√∫c c√¥ng ch√∫a <b>B·∫£o Ng·ªçc</b> c√≥ m·ªôt ng√†y sinh nh·∫≠t th·∫≠t ƒë·∫∑c bi·ªát üå∏<br><br>
        Tu·ªïi m·ªõi ni·ªÅm vui m·ªõi h·∫°nh ph√∫c m·ªõi v√† ng∆∞·ªùi y√™u v·∫´n kh√¥ng thay ƒë·ªïi, ch√∫c c√¥ng ch√∫a B·∫£o Ng·ªçc h√¥m nay s·∫Ω c√≥ 1 ng√†y sinh nh·∫≠t √Ω nghƒ©a, h·∫°nh ph√∫c, ƒë·∫∑c bi·ªát nh·∫•t v√† tr·ªçn ƒë·∫ßy ni·ªÅm vui.<br><br> Ch√∫c n√†ng sang tu·ªïi m·ªõi ng√†y c√†ng sinh ƒë·∫πp n√®, h·ªçc gi·ªèi n√®, nghe l·ªùi b·ªë m·∫π nh√¨u n·ªØa n√®, v√† y√™u anh nhi·ªÅu h∆°n n·ªØa n√®, v√† vui t∆∞∆°i h·∫°nh ph√∫c nhi·ªÅu nhi·ªÅu h∆°n n·ªØa.<br><br>
        <b>Ch√†o m·ª´ng tu·ªïi 16</b><br>
        <b>HAPPY BIRTHDAY üéâüéâ‚ù§Ô∏è</b>
      </p>
      <button id="closeBtn">‚ú® ·∫§n ƒë·ªÉ xem ƒëi·ªÅu b·∫•t ng·ªù ‚ú®</button>
    </div>
  </div>
</div>

<!-- GALAXY -->
<div id="canvasScreen">
  <canvas id="c"></canvas>
  <audio id="bg-music" loop>
    <source src="happy-birthday-368842.mp3" type="audio/mpeg">
  </audio>
</div>

<script type="importmap">
{"imports":{"three":"https://unpkg.com/three@0.157.0/build/three.module.js","three/addons/":"https://unpkg.com/three@0.157.0/examples/jsm/"}}
</script>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { FontLoader } from 'three/addons/loaders/FontLoader.js';
import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

/* ---------- Pass logic ---------- */
const passScreen = document.getElementById('passScreen');
const bookScreen = document.getElementById('bookScreen');
const canvasScreen = document.getElementById('canvasScreen');
const dots = document.getElementById('dots');
let input = '';

document.querySelectorAll('.keypad button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const v = btn.textContent;
    if (v==='‚Üê') input=input.slice(0,-1);
    else if (v==='‚úì') {
      if (input==='17102009') { // m·∫≠t kh·∫©u
        passScreen.style.display='none';
        bookScreen.style.display='flex';
      }
    } else if (input.length<8) input+=v;
    dots.textContent = '‚Ä¢'.repeat(input.length);
  });
});

/* ---------- Book open ---------- */
document.getElementById('cover').addEventListener('click',()=> {
  document.getElementById('cover').classList.add('open');
});
document.getElementById('closeBtn').addEventListener('click',()=>{
  bookScreen.style.display='none';
  canvasScreen.style.display='block';
  initGalaxy();
});

/* ---------- Galaxy ---------- */
function initGalaxy(){
  const canvas = document.getElementById('c');
  const renderer = new THREE.WebGLRenderer({canvas, antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(65, window.innerWidth/window.innerHeight, 0.1, 20000);
  camera.position.set(0, 120, 2000);

  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.autoRotate = true;
  controls.autoRotateSpeed = 0.38;

  // music (autoplay mobile c·∫ßn ch·∫°m)
  const music = document.getElementById('bg-music'); music.volume = 0.6;
  const tryPlay = () => music.play().catch(()=>{});
  document.body.addEventListener('click', tryPlay, {once:true});
  document.body.addEventListener('touchstart', tryPlay, {once:true});

  /* ‚≠ê Stars */
  const starCount = 10000;
  const starPos = new Float32Array(starCount*3);
  for (let i=0;i<starCount;i++){
    starPos[i*3]   = (Math.random()-0.5)*12000;
    starPos[i*3+1] = (Math.random()-0.5)*12000;
    starPos[i*3+2] = (Math.random()-0.5)*12000;
  }
  const starGeo = new THREE.BufferGeometry();
  starGeo.setAttribute('position', new THREE.BufferAttribute(starPos,3));
  scene.add(new THREE.Points(starGeo, new THREE.PointsMaterial({color:0xffffff, size:1})));

  /* üí° Lights */
  scene.add(new THREE.AmbientLight(0xffffff,1.15));
  const pLight = new THREE.PointLight(0xffffff,2.8,8000);
  pLight.position.set(0,1000,1500); scene.add(pLight);

  /* üéÇ Cake */
  const cake = new THREE.Group(); scene.add(cake);
  cake.add(new THREE.Mesh(new THREE.CylinderGeometry(300,300,120,64), new THREE.MeshPhongMaterial({color:0xfff59d})));
  const mid = new THREE.Mesh(new THREE.CylinderGeometry(220,220,100,64), new THREE.MeshPhongMaterial({color:0xff80ab}));
  mid.position.y=110; cake.add(mid);
  const top = new THREE.Mesh(new THREE.CylinderGeometry(140,140,80,64), new THREE.MeshPhongMaterial({color:0xba68c8}));
  top.position.y=200; cake.add(top);

  // kem
  const addCream=(r,y)=>{
    const t=new THREE.Mesh(new THREE.TorusGeometry(r,12,16,100), new THREE.MeshPhongMaterial({color:0xffffff}));
    t.rotation.x=Math.PI/2; t.position.y=y; cake.add(t);
  };
  addCream(300,60); addCream(220,160); addCream(140,240);

  // n·∫øn
  const flames=[];
  for (let i=0;i<6;i++){
    const candle=new THREE.Mesh(new THREE.CylinderGeometry(10,10,60,16), new THREE.MeshPhongMaterial({color:0xffffff}));
    const a=i*Math.PI/3;
    candle.position.set(Math.cos(a)*100,260,Math.sin(a)*100);
    cake.add(candle);
    const flame=new THREE.Mesh(new THREE.SphereGeometry(14,16,16), new THREE.MeshBasicMaterial({color:0xfff176,transparent:true,opacity:0.9}));
    flame.position.y=35; candle.add(flame); flames.push(flame);
  }

  /* ‚ù§Ô∏è ·∫¢nh bung ra ‚Üí v√†nh ƒëai ph·∫≥ng x·∫øp ‚Äúlo·∫°n‚Äù */
  const loader = new THREE.TextureLoader();
  const belt = new THREE.Group(); scene.add(belt);
  const imgs = ["anh/anh1.jpg","anh/anh2.jpg","anh/anh3.jpg","anh/anh4.jpg", "anh/anh5.jpg",
  "anh/anh6.jpg","anh/anh7.jpg","anh/anh8.jpg","anh/anh9.jpg", "anh/anh10.jpg",
    "anh/anh11.jpg","anh/anh12.jpg","anh/anh13.jpg","anh/anh14.jpg", "anh/anh15.jpg",
    "anh/anh16.jpg","anh/anh17.jpg","anh/anh18.jpg","anh/anh19.jpg", "anh/anh20.jpg"];
  const textures = imgs.map(u=>loader.load(u));
  const toRad=(d)=>d*Math.PI/180;

  for (let i=0;i<150;i++){
    const tex = textures[i%textures.length];
    const sp  = new THREE.Sprite(new THREE.SpriteMaterial({map:tex,transparent:true}));
    const size = 50+Math.random()*40; sp.scale.set(size,size,1);
    const angle = Math.random()*Math.PI*2;
    const rStart= 380 + Math.random()*40;             // b·∫Øn ra t·ª´ g·∫ßn b√°nh
    const rEnd  = 650 + Math.random()*500;            // b√°n k√≠nh v√†nh ƒëai
    const jitter = (Math.random()-0.5)*80;            // x·∫øp h∆°i lo·∫°n tr√™n 1 m·∫∑t ph·∫≥ng (y ‚âà 0)
    sp.position.set(Math.cos(angle)*rStart, jitter*0.15, Math.sin(angle)*rStart);
   sp.userData = {r:rStart, rEnd, angle, speed:0.001+Math.random()*0.002, jitter};

    belt.add(sp);
  }

  /* üå† Sao bƒÉng ƒëa m√†u (ki·ªÉu phim) */
  const shootingStars=[];
  const colors=[0xffffff,0xffe066,0x66ccff,0xff6ec7];
  function makeShootingStar(){
    const head = new THREE.Mesh(new THREE.SphereGeometry(9,10,10), new THREE.MeshBasicMaterial({color: colors[Math.floor(Math.random()*colors.length)]}));
    const tail = new THREE.Mesh(new THREE.PlaneGeometry(220,10), new THREE.MeshBasicMaterial({color:0xffffff,transparent:true,opacity:0.6,blending:THREE.AdditiveBlending,side:THREE.DoubleSide}));
    tail.position.x=-110; head.add(tail);
    head.position.set((Math.random()-0.5)*6000,Math.random()*2500+1200,-5000);
    head.rotation.z=-Math.PI/5;
    head.userData={vx:-(20+Math.random()*22),vy:-(12+Math.random()*16),vz:(18+Math.random()*22)};
    scene.add(head); shootingStars.push(head);
    setTimeout(()=>{scene.remove(head); shootingStars.splice(shootingStars.indexOf(head),1);}, 5000);
  }
  // ph√≥ng sao bƒÉng ƒë·ªÅu ƒë·ªÅu
  setInterval(()=>{ if(shootingStars.length<6) makeShootingStar(); }, 900);

  /* üéâ Banner ch·ªØ v√≤ng cung ‚Äì nhanh h∆°n */
  const fontLoader = new FontLoader();
  fontLoader.load("https://threejs.org/examples/fonts/optimer_bold.typeface.json",(font)=>{
    const text="HAPPY BIRTHDAY";
    const R=900, Y=850, total=Math.PI/1.2, start=-total/2;
    for(let i=0;i<text.length;i++){
      const geo=new TextGeometry(text[i],{font,size:90,height:20});
      const mat=new THREE.MeshPhongMaterial({color:0xffffff,emissive:0xff66cc,transparent:true,opacity:0});
      const m=new THREE.Mesh(geo,mat);
      const ang=start+(i/(text.length-1))*total;
      m.position.set(Math.cos(ang)*R, Y, Math.sin(ang)*R);
      m.lookAt(0,Y,0); scene.add(m);
      // fade-in r·∫•t nhanh
      setTimeout(()=>{let o=0; const f=()=>{o+=0.6; m.material.opacity=o; if(o<1) requestAnimationFrame(f);}; f();}, i*18);
    }
  });

  /* üé• Zoom-in khi b·∫Øt ƒë·∫ßu */
  let zoomT=0;  // 0 ‚Üí 1
  function animate(){
    requestAnimationFrame(animate);

    if(zoomT<1){ zoomT+=0.004; camera.position.z = 2000 - zoomT*800; } // 2000 ‚Üí 1200

    // n·∫øn flicker
    flames.forEach((fl,i)=>{
      fl.scale.setScalar(1+0.22*Math.sin(Date.now()*0.012+i*1.7));
      fl.material.opacity = 0.8 + 0.2*Math.sin(Date.now()*0.02+i*1.3);
    });

    // v√†nh ƒëai ·∫£nh: bung ra + ch·∫°y v√≤ng, n·∫±m tr√™n m·ªôt m·∫∑t ph·∫≥ng (y ‚âà 0)
    belt.children.forEach(sp=>{
      sp.userData.r += (sp.userData.rEnd - sp.userData.r)*0.035; // easing
      sp.userData.angle += sp.userData.speed;
      sp.position.x = Math.cos(sp.userData.angle)*sp.userData.r;
      sp.position.z = Math.sin(sp.userData.angle)*sp.userData.r;
      sp.position.y = sp.userData.jitter*0.15; // ph·∫≥ng nh∆∞ng h∆°i ‚Äúnh·∫•p nh√¥‚Äù
    });

    // sao bƒÉng bay
    shootingStars.forEach(s=>{
      s.position.x += s.userData.vx;
      s.position.y += s.userData.vy;
      s.position.z += s.userData.vz;
    });

    cake.rotation.y += 0.002;
    controls.update();
    renderer.render(scene,camera);
  }
  animate();

  // responsive + xoay ngang
  addEventListener('resize', ()=>{
    renderer.setSize(innerWidth,innerHeight);
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
  }, {passive:true});
}
</script>
</body>
</html>
