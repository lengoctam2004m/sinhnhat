<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Happy Birthday 💖</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<style>
  body,html {margin:0;padding:0;height:100%;width:100%;font-family:'Segoe UI',sans-serif;overflow:hidden;}

  /* PASS SCREEN */
  #passScreen{
    display:flex;justify-content:center;align-items:center;height:100%;
    background:linear-gradient(135deg,#ffe6ec,#ffd6f6);
  }
  .pass-box{
    display:flex;flex-direction:row;max-width:95%;width:650px;
    border-radius:20px;overflow:hidden;background:#fff;
    box-shadow:0 8px 30px rgba(0,0,0,0.25);
  }
  .pass-left{flex:1;display:flex;align-items:center;justify-content:center;background:#ffe6ec;padding:20px;}
  .pass-left img{
    width:100%;max-width:250px;height:auto;border-radius:20px;border:8px solid #fff;
    box-shadow:0 10px 25px rgba(0,0,0,0.35);object-fit:cover;
  }
  .pass-right{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;}
  .pass-right h2{font-size:20px;color:#ff4d88;margin:0 0 15px;text-align:center;}
  .dots{font-size:26px;letter-spacing:12px;margin-bottom:20px;color:#ff4d88;}
  .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;width:100%;max-width:240px;}
  .keypad button{
    aspect-ratio:1/1;font-size:18px;font-weight:bold;border:none;border-radius:12px;
    background:#f2f2f2;cursor:pointer;transition:0.2s;
  }
  .keypad button:active{background:#ff99cc;color:#fff;transform:scale(0.95);}
  @media (max-width:768px){
    .pass-box{flex-direction:column;width:90%;}
    .pass-left img{max-width:180px;}
    .dots{font-size:20px;}
  }

  /* BOOK (thiệp) */
  #bookScreen{
    display:none;justify-content:center;align-items:center;height:100%;width:100%;
    background:linear-gradient(120deg,#ffe6f0,#fff0f6);
  }
  .book{
    position:relative;
    width:min(95vw,720px);
    height:clamp(360px,70vh,520px);
    perspective:1500px;
  }
  .page{
    position:absolute;inset:0;border-radius:14px;
    /* KHÔNG đổ bóng ở đây để trang trong không lộ */
  }
  .cover{
    background:#ffb3c6;display:flex;align-items:center;justify-content:center;
    font-size:22px;font-weight:bold;color:#222;cursor:pointer;
    transform-origin:left center;transition:transform 1s ease;z-index:2;
    backface-visibility:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,0.28); /* bóng chỉ cho bìa */
  }
  .cover.open{transform:rotateY(-100deg);pointer-events:none;}
  .inner{
    background:#fff;z-index:1;display:flex;flex-direction:column;justify-content:center;align-items:center;
    text-align:center;padding:30px;overflow:auto; /* không có box-shadow để khỏi lộ viền khi đóng */
  }
  .inner h2{margin:0 0 15px;font-size:24px;color:#ff3366;}
  .inner p{font-size:15px;line-height:1.6;color:#444;}
  #closeBtn{
    margin-top:25px;padding:10px 20px;border:none;border-radius:8px;background:#ff3366;color:#fff;font-size:14px;cursor:pointer;
  }
  #closeBtn:active{background:#ff004c;transform:scale(0.95);}

  /* GALAXY */
  #canvasScreen{display:none;position:fixed;inset:0;background:#000;}
  #c{width:100%;height:100%;display:block;}
</style>
</head>
<body>

<!-- PASS -->
<div id="passScreen">
  <div class="pass-box">
    <div class="pass-left"><img src="anh/anh4.jpg" alt="avatar"></div>
    <div class="pass-right">
      <h2>Xin chào Công chúa Bảo Ngọc 💖</h2>
      <div class="dots" id="dots">****</div>
      <div class="keypad">
        <button>1</button><button>2</button><button>3</button>
        <button>4</button><button>5</button><button>6</button>
        <button>7</button><button>8</button><button>9</button>
        <button>←</button><button>0</button><button>✓</button>
      </div>
    </div>
  </div>
</div>

<!-- BOOK -->
<div id="bookScreen">
  <div class="book">
    <div class="page cover" id="cover"><span>📖 Công chúa hãy mở thiệp đi</span></div>
    <div class="page inner">
      <h2>🎂 Chúc mừng sinh nhật 🎂</h2>
      <p>
        Chúc công chúa <b>Bảo Ngọc</b> có một ngày sinh nhật thật đặc biệt 🌸<br><br>
        Mong em luôn xinh đẹp, hạnh phúc, học giỏi và yêu đời 💖<br><br>
        <b>HAPPY BIRTHDAY 🎉🎉❤️</b>
      </p>
      <button id="closeBtn">✨ Ấn để xem điều bất ngờ ✨</button>
    </div>
  </div>
</div>

<!-- GALAXY -->
<div id="canvasScreen">
  <canvas id="c"></canvas>
  <audio id="bg-music" loop>
    <source src="happy-birthday-368842.mp3" type="audio/mpeg">
  </audio>
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { FontLoader } from 'three/addons/loaders/FontLoader.js';
import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

const passScreen=document.getElementById("passScreen");
const bookScreen=document.getElementById("bookScreen");
const canvasScreen=document.getElementById("canvasScreen");
const dots=document.getElementById("dots");
let input="";

/* PASS */
document.querySelectorAll(".keypad button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    const val=btn.textContent;
    if(val==="←"){ input=input.slice(0,-1); }
    else if(val==="✓"){
      if(input==="17102009"){ passScreen.style.display="none"; bookScreen.style.display="flex"; }
    } else { if(input.length<8) input+=val; }
    dots.textContent="•".repeat(input.length);
  });
});

/* BOOK */
document.getElementById("cover").addEventListener("click",()=>{ document.getElementById("cover").classList.add("open"); });
document.getElementById("closeBtn").addEventListener("click",()=>{
  bookScreen.style.display="none";
  canvasScreen.style.display="block";
  initGalaxy();
});

/* GALAXY */
function initGalaxy(){
  const canvas=document.getElementById("c");
  const renderer=new THREE.WebGLRenderer({canvas,antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));

  const scene=new THREE.Scene();
  const camera=new THREE.PerspectiveCamera(65,window.innerWidth/window.innerHeight,0.1,20000);
  camera.position.set(0,400,2200);

  const controls=new OrbitControls(camera,renderer.domElement);
  controls.enableDamping=true;
  controls.autoRotate=true;
  controls.autoRotateSpeed=0.35; /* xoay nhanh nhẹ cho sinh động */

  // Nhạc (mobile cần thao tác 1 lần)
  const bgMusic=document.getElementById("bg-music");
  bgMusic.volume=0.6;
  const unlock=()=>bgMusic.play().catch(()=>{});
  document.body.addEventListener("click",unlock,{once:true});
  document.body.addEventListener("touchstart",unlock,{once:true});

  // Stars (giảm tải trên mobile)
  const starCount=(window.innerWidth<768?3500:8000);
  const stars=new Float32Array(starCount*3);
  for(let i=0;i<starCount;i++){
    stars[i*3]=(Math.random()-0.5)*12000;
    stars[i*3+1]=(Math.random()-0.5)*12000;
    stars[i*3+2]=(Math.random()-0.5)*12000;
  }
  const starGeo=new THREE.BufferGeometry();
  starGeo.setAttribute("position",new THREE.BufferAttribute(stars,3));
  scene.add(new THREE.Points(starGeo,new THREE.PointsMaterial({color:0xffffff,size:1})));

  // Light
  scene.add(new THREE.AmbientLight(0xffffff,1.2));
  const light=new THREE.PointLight(0xffffff,3,8000);
  light.position.set(0,1000,1500);
  scene.add(light);

  // Cake
  const cake=new THREE.Group(); scene.add(cake);
  cake.add(new THREE.Mesh(new THREE.CylinderGeometry(300,300,120,64),new THREE.MeshPhongMaterial({color:0xfff59d})));
  const mid=new THREE.Mesh(new THREE.CylinderGeometry(220,220,100,64),new THREE.MeshPhongMaterial({color:0xff80ab}));
  mid.position.y=110; cake.add(mid);
  const top=new THREE.Mesh(new THREE.CylinderGeometry(140,140,80,64),new THREE.MeshPhongMaterial({color:0xba68c8}));
  top.position.y=200; cake.add(top);

  // Hearts
  const heartShape=new THREE.Shape();
  heartShape.moveTo(0,0);
  heartShape.bezierCurveTo(0,0,-10,-10,-25,0);
  heartShape.bezierCurveTo(-40,20,0,40,0,60);
  heartShape.bezierCurveTo(0,40,40,20,25,0);
  heartShape.bezierCurveTo(10,-10,0,0,0,0);
  const heartGeo=new THREE.ShapeGeometry(heartShape);
  const heartMat=new THREE.MeshBasicMaterial({color:0xff4081,side:THREE.DoubleSide});
  const hearts=[];
  for(let i=0;i<20;i++){
    const m=new THREE.Mesh(heartGeo,heartMat);
    const s=0.3+Math.random()*0.3;
    m.scale.set(s,s,s);
    m.position.set((Math.random()-0.5)*2000,-200,(Math.random()-0.5)*2000);
    hearts.push(m); scene.add(m);
  }

  // Avatar belt
  const avatarUrls=["anh/anh1.jpg","anh/anh2.jpg","anh/anh3.jpg","anh/anh4.jpg","anh/anh5.jpg","anh/anh6.jpg","anh/anh7.jpg","anh/anh8.jpg","anh/anh9.jpg","anh/anh10.jpg"];
  const loader=new THREE.TextureLoader();
  const belt=new THREE.Group(); scene.add(belt);
  const textures=avatarUrls.map(url=>loader.load(url));
  const count=(window.innerWidth<768?60:120);
  for(let i=0;i<count;i++){
    const tex=textures[i%textures.length];
    const sp=new THREE.Sprite(new THREE.SpriteMaterial({map:tex,transparent:true}));
    const size=60+Math.random()*40; sp.scale.set(size,size,1);
    const r=1100+Math.random()*300, a=Math.random()*Math.PI*2, y=(Math.random()-0.5)*300;
    sp.position.set(Math.cos(a)*r,y,Math.sin(a)*r);
    sp.userData={r,angle:a,speed:0.001+Math.random()*0.001};
    belt.add(sp);
  }

  // Banner chữ – tăng tốc xuất hiện
  const fontLoader=new FontLoader();
  fontLoader.load("https://threejs.org/examples/fonts/optimer_bold.typeface.json",(font)=>{
    const text="HAPPY BIRTHDAY";
    const radius=900, centerY=1000, totalAngle=Math.PI/1.2, startAngle=-totalAngle/2;
    const perLetterDelay=10;      // ms
    const alphaStep=0.6;          // tăng nhanh độ mờ

    for(let i=0;i<text.length;i++){
      const geo=new TextGeometry(text[i],{font,size:90,height:20});
      const mat=new THREE.MeshPhongMaterial({color:0xffffff,emissive:0xff66cc,transparent:true,opacity:0});
      const mesh=new THREE.Mesh(geo,mat);
      const angle=startAngle+(i/(text.length-1))*totalAngle;
      mesh.position.set(Math.cos(angle)*radius,centerY,Math.sin(angle)*radius);
      mesh.lookAt(0,centerY,0);
      scene.add(mesh);

      setTimeout(()=>{
        let a=0;
        (function fade(){
          a+=alphaStep; mesh.material.opacity=a;
          if(a<1) requestAnimationFrame(fade);
        })();
      }, i*perLetterDelay);
    }
  });

  function animate(){
    requestAnimationFrame(animate);
    cake.rotation.y+=0.002;
    hearts.forEach(h=>{h.position.y+=2; if(h.position.y>1500) h.position.y=-200; h.rotation.z+=0.02;});
    belt.children.forEach(sp=>{
      sp.userData.angle+=sp.userData.speed;
      sp.position.x=Math.cos(sp.userData.angle)*sp.userData.r;
      sp.position.z=Math.sin(sp.userData.angle)*sp.userData.r;
    });
    controls.update();
    renderer.render(scene,camera);
  }
  animate();

  // resize + xoay ngang
  window.addEventListener("resize",()=>{
    renderer.setSize(window.innerWidth,window.innerHeight);
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
  });
}
</script>
</body>
</html>
