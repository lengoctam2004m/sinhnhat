<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Happy Birthday 💖</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body,html {
    margin:0;padding:0;height:100%;width:100%;
    font-family:'Segoe UI',sans-serif;background:#fdfdfd;
    overflow:hidden;
  }

  /* === PASS SCREEN === */
  #passScreen {
    display:flex;justify-content:center;align-items:center;
    height:100%;background:linear-gradient(135deg,#ffe6ec,#ffd6f6);
  }
  .pass-box {
    display:flex;box-shadow:0 8px 30px rgba(0,0,0,0.25);
    border-radius:12px;overflow:hidden;background:#fff;
    animation: fadeIn 1s ease;
  }
  .pass-left {
    background:#ffe6ec;display:flex;align-items:center;justify-content:center;
    width:250px;padding:15px;
  }
  .pass-left img {
    width:200px;height:200px;border-radius:12px;object-fit:cover;
    box-shadow:0 5px 20px rgba(0,0,0,0.2);
  }
  .pass-right {
    background:#fff;padding:30px;display:flex;flex-direction:column;
    align-items:center;justify-content:center;
  }
  .pass-right h2 {
    margin:0 0 15px;font-size:22px;color:#ff4d88;text-align:center;
  }
  .dots {
    font-size:28px;letter-spacing:12px;margin-bottom:20px;color:#ff4d88;
  }
  .keypad {
    display:grid;grid-template-columns:repeat(3,70px);grid-gap:12px;
  }
  .keypad button {
    padding:18px;font-size:20px;font-weight:bold;
    border:none;border-radius:10px;background:#f2f2f2;cursor:pointer;
    transition:0.2s;
  }
  .keypad button:hover {background:#ff99cc;color:#fff;transform:scale(1.05);}

  /* === BOOK SCREEN === */
  #bookScreen {
    display:none;justify-content:center;align-items:center;
    height:100%;background:linear-gradient(120deg,#ffe6f0,#fff0f6);
  }
  .book {
    position:relative;width:650px;height:420px;perspective:1500px;
  }
  .page {
    position:absolute;top:0;left:0;width:100%;height:100%;
    border-radius:10px;box-shadow:0 6px 25px rgba(0,0,0,0.25);
  }
  .cover {
    background:#ffb3c6;display:flex;align-items:center;justify-content:center;
    font-size:28px;font-weight:bold;cursor:pointer;color:#222;
    transform-origin:left center;
    backface-visibility:hidden;
    transition:transform 1s ease;
    z-index:2;
  }
  .cover.open {
    transform: rotateY(-100deg);
    pointer-events:none;
  }
  .inner {
    background:#fff;z-index:1;
    display:flex;flex-direction:column;justify-content:center;align-items:center;
    text-align:center;padding:40px;box-sizing:border-box;
  }
  .inner h2 {margin:0 0 15px;font-size:32px;color:#ff3366;}
  .inner p {font-size:18px;line-height:1.6;color:#444;}
  #closeBtn {
    margin-top:25px;padding:12px 24px;
    border:none;border-radius:8px;background:#ff3366;
    color:#fff;font-size:16px;cursor:pointer;
    box-shadow:0 4px 10px rgba(0,0,0,0.2);
    transition:0.3s;
  }
  #closeBtn:hover {background:#ff004c;transform:scale(1.05);}

  /* === GALAXY SCREEN === */
  #canvasScreen {display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#000;}
  #c {width:100%;height:100%;display:block;}

  @keyframes fadeIn {from{opacity:0;transform:scale(0.9);}to{opacity:1;transform:scale(1);}}
</style>
</head>
<body>
<!-- PASS SCREEN -->
<div id="passScreen">
  <div class="pass-box">
    <div class="pass-left">
      <img src="anh/anh4.jpg" alt="avatar"/>
    </div>
    <div class="pass-right">
      <h2>Xin chào Công chúa Bảo Ngọc 💖</h2>
      <div class="dots" id="dots">****</div>
      <div class="keypad">
        <button>1</button><button>2</button><button>3</button>
        <button>4</button><button>5</button><button>6</button>
        <button>7</button><button>8</button><button>9</button>
        <button>←</button><button>0</button><button>✓</button>
      </div>
    </div>
  </div>
</div>

<!-- BOOK SCREEN -->
<div id="bookScreen">
  <div class="book">
    <div class="page cover" id="cover"><span>📕 Công chúa hãy mở thiệp đi</span></div>
    <div class="page inner">
      <h2>🎂 Chúc mừng sinh nhật 🎂</h2>
      <p>
        Tuổi mới niềm vui mới, hạnh phúc mới và tình yêu vẫn trọn vẹn 💕<br><br>
        Chúc công chúa <b>Bảo Ngọc</b> hôm nay có một ngày sinh nhật thật đặc biệt,
        ý nghĩa và tràn ngập niềm vui 🌸<br><br>
        Mong em sẽ ngày càng xinh đẹp, học giỏi, ngoan ngoãn nghe lời bố mẹ,
        yêu anh/anh nhiều hơn nữa, và mãi hạnh phúc 💖<br><br>
        Chúc mừng tuổi 16 của em! <b>HAPPY BIRTHDAY 🎉🎉❤️</b>
      </p>
      <button id="closeBtn">✨ Ấn để xem điều bất ngờ ✨</button>
    </div>
  </div>
</div>

<!-- CANVAS SCREEN -->
<div id="canvasScreen">
  <canvas id="c"></canvas>
  <!-- nhạc nền -->
  <audio id="bg-music" loop>
    <source src="happy-birthday-368842.mp3" type="audio/mpeg">
  </audio>
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { FontLoader } from 'three/addons/loaders/FontLoader.js';
import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

const passScreen=document.getElementById("passScreen");
const bookScreen=document.getElementById("bookScreen");
const canvasScreen=document.getElementById("canvasScreen");
const dots=document.getElementById("dots");
let input="";

// === Pass logic ===
document.querySelectorAll(".keypad button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    const val=btn.textContent;
    if(val==="←"){ input=input.slice(0,-1);}
    else if(val==="✓"){
      if(input==="17102009"){ // pass đúng
        passScreen.style.display="none";bookScreen.style.display="flex";
      }
    } else { if(input.length<9) input+=val; }
    dots.textContent="•".repeat(input.length);
  });
});

// Book cover mở
document.getElementById("cover").addEventListener("click",()=>{
  document.getElementById("cover").classList.add("open");
});

// Đóng sổ -> show galaxy
document.getElementById("closeBtn").addEventListener("click",()=>{
  bookScreen.style.display="none";
  canvasScreen.style.display="block";
  initGalaxy();
});

/* === GALAXY SCENE MỚI === */
function initGalaxy(){
  const canvas=document.getElementById("c");
  const renderer=new THREE.WebGLRenderer({canvas,antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));

  const scene=new THREE.Scene();
  const camera=new THREE.PerspectiveCamera(65,window.innerWidth/window.innerHeight,0.1,20000);
  camera.position.set(0,400,2200);

  const controls=new OrbitControls(camera,renderer.domElement);
  controls.enableDamping=true;
  controls.autoRotate=true;
  controls.autoRotateSpeed=0.25;

  // 🎶 Nhạc nền
  const bgMusic=document.getElementById("bg-music");
  bgMusic.volume=0.6;
  function playMusic(){ bgMusic.play().catch(()=>{}); }
  document.body.addEventListener("click", playMusic, {once:true});
  document.body.addEventListener("touchstart", playMusic, {once:true});

  // ⭐ Stars
  const stars=new Float32Array(10000*3);
  for(let i=0;i<10000;i++){
    stars[i*3]=(Math.random()-0.5)*12000;
    stars[i*3+1]=(Math.random()-0.5)*12000;
    stars[i*3+2]=(Math.random()-0.5)*12000;
  }
  const starGeo=new THREE.BufferGeometry();
  starGeo.setAttribute("position",new THREE.BufferAttribute(stars,3));
  scene.add(new THREE.Points(starGeo,new THREE.PointsMaterial({color:0xffffff,size:1})));

  // 💡 Lights
  scene.add(new THREE.AmbientLight(0xffffff,1.2));
  const light=new THREE.PointLight(0xffffff,3,8000);
  light.position.set(0,1000,1500);
  scene.add(light);

  // 🎂 Bánh sinh nhật
  const cake=new THREE.Group(); scene.add(cake);
  cake.add(new THREE.Mesh(new THREE.CylinderGeometry(300,300,120,64),
    new THREE.MeshPhongMaterial({color:0xfff59d,shininess:400,specular:0xffffff})));
  const mid=new THREE.Mesh(new THREE.CylinderGeometry(220,220,100,64),
    new THREE.MeshPhongMaterial({color:0xff80ab,shininess:400,specular:0xffffff}));
  mid.position.y=110; cake.add(mid);
  const top=new THREE.Mesh(new THREE.CylinderGeometry(140,140,80,64),
    new THREE.MeshPhongMaterial({color:0xba68c8,shininess:400,specular:0xffffff}));
  top.position.y=200; cake.add(top);

  function addCream(radius,y){
    const cream=new THREE.Mesh(new THREE.TorusGeometry(radius,12,16,100),
      new THREE.MeshPhongMaterial({color:0xffffff,shininess:300,specular:0xffffff}));
    cream.rotation.x=Math.PI/2; cream.position.y=y; cake.add(cream);
  }
  addCream(300,60); addCream(220,160); addCream(140,240);

  // nến
  const flames=[];
  for(let i=0;i<8;i++){
    const candle=new THREE.Mesh(new THREE.CylinderGeometry(10,10,60,16),
      new THREE.MeshPhongMaterial({color:0xffffff,shininess:200}));
    const angle=i*Math.PI/4;
    candle.position.set(Math.cos(angle)*100,260,Math.sin(angle)*100);
    cake.add(candle);
    const flame=new THREE.Mesh(new THREE.SphereGeometry(14,16,16),
      new THREE.MeshBasicMaterial({color:0xfff176,transparent:true,opacity:0.95}));
    flame.position.y=35; candle.add(flame); flames.push(flame);
  }

  // trái tim bay
  const heartShape=new THREE.Shape();
  heartShape.moveTo(0,0);
  heartShape.bezierCurveTo(0,0,-10,-10,-25,0);
  heartShape.bezierCurveTo(-40,20,0,40,0,60);
  heartShape.bezierCurveTo(0,40,40,20,25,0);
  heartShape.bezierCurveTo(10,-10,0,0,0,0);
  const heartGeo=new THREE.ShapeGeometry(heartShape);
  const heartMat=new THREE.MeshBasicMaterial({color:0xff4081,side:THREE.DoubleSide});
  const hearts=[];
  for(let i=0;i<30;i++){
    const mesh=new THREE.Mesh(heartGeo,heartMat);
    const s=0.3+Math.random()*0.3;
    mesh.scale.set(s,s,s);
    mesh.position.set((Math.random()-0.5)*2000,-200,(Math.random()-0.5)*2000);
    hearts.push(mesh); scene.add(mesh);
  }

  // Avatar belt
  const avatarUrls=["anh/anh1.jpg","anh/anh2.jpg","anh/anh3.jpg","anh/anh4.jpg","anh/anh5.jpg",
    "anh/anh6.jpg","anh/anh7.jpg","anh/anh8.jpg","anh/anh9.jpg","anh/anh10.jpg", "anh/anh11.jpg",
    "anh/anh12.jpg","anh/anh13.jpg","anh/anh14.jpg","anh/anh15.jpg", "anh/anh16.jpg", "anh/anh17.jpg",
    "anh/anh18.jpg","anh/anh19.jpg","anh/anh20.jpg"];
  const loader=new THREE.TextureLoader();
  const belt=new THREE.Group(); scene.add(belt);
  const textures=avatarUrls.map(url=>loader.load(url));
  for(let i=0;i<200;i++){
    const tex=textures[i%textures.length];
    const sp=new THREE.Sprite(new THREE.SpriteMaterial({map:tex,transparent:true}));
    const size=70+Math.random()*50;
    sp.scale.set(size,size,1);
    const r=1300+Math.random()*500; const a=Math.random()*Math.PI*2;
    const y=(Math.random()-0.5)*600;
    sp.position.set(Math.cos(a)*r,y,Math.sin(a)*r);
    sp.userData={r,angle:a,speed:0.0005+Math.random()*0.001};
    belt.add(sp);
  }

  // Banner chữ vòng cung
  let bannerLetters=[];
  const fontLoader=new FontLoader();
  fontLoader.load("https://threejs.org/examples/fonts/optimer_bold.typeface.json",function(font){
    const text="HAPPY BIRTHDAY";
    const radius=1000; const centerY=1000; const totalAngle=Math.PI/1.2;  
    const startAngle=-totalAngle/2;
    for(let i=0;i<text.length;i++){
      const geo=new TextGeometry(text[i],{font:font,size:100,height:20});
      const mat=new THREE.MeshPhongMaterial({color:0xffffff,emissive:0xff66cc,transparent:true,opacity:0});
      const mesh=new THREE.Mesh(geo,mat);
      const angle=startAngle+(i/(text.length-1))*totalAngle;
      const x=Math.cos(angle)*radius; const z=Math.sin(angle)*radius;
      mesh.position.set(x,centerY,z);
      mesh.lookAt(camera.position.x,centerY,camera.position.z);
      scene.add(mesh);
      bannerLetters.push({mesh,angle});
      setTimeout(()=>{ let alpha=0; function fadeIn(){alpha+=0.05;mesh.material.opacity=alpha;if(alpha<1) requestAnimationFrame(fadeIn);} fadeIn(); }, i*200);
    }
  });

  // Animate
  function animate(){
    requestAnimationFrame(animate);
    cake.rotation.y+=0.002;
    flames.forEach((fl,i)=>{ fl.scale.setScalar(1+0.2*Math.sin(Date.now()*0.01+i)); fl.material.opacity=0.8+0.2*Math.sin(Date.now()*0.02+i); });
    hearts.forEach(h=>{ h.position.y+=2; if(h.position.y>1500) h.position.y=-200; h.rotation.z+=0.02; });
    belt.children.forEach(sp=>{ sp.userData.angle+=sp.userData.speed; sp.position.x=Math.cos(sp.userData.angle)*sp.userData.r; sp.position.z=Math.sin(sp.userData.angle)*sp.userData.r; });
    controls.update(); renderer.render(scene,camera);
  }
  animate();

  window.addEventListener("resize",()=>{ renderer.setSize(window.innerWidth,window.innerHeight); camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); });
}
</script>
</body>
</html>
